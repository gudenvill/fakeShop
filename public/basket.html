<!DOCTYPE html>
<html lang="sv">

<head>
    <!-- Meta-taggar f√∂r dokumenttyp och responsiv design -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Sidans titel som visas i webbl√§sarens flik -->
    <title>FakeShop | Varukorg</title>
    
    <!-- Externa CSS-bibliotek f√∂r ikoner (Font Awesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Lokal CSS f√∂r grundl√§ggande styling av hela sidan -->
    <link rel="stylesheet" href="./css/styles.css">
    
    <!-- Specifik CSS f√∂r varukorgssidans styling -->
    <link rel="stylesheet" href="./css/basketStyles.css">
</head>

<body>
    <!-- Huvudwrapper som omsluter hela sidans inneh√•ll -->
    <div class="wrapper">
        
        <!-- HEADER-SEKTION: Inneh√•ller logotyp och navigationsverktyg -->
        <header class="header">
            <!-- Logotypomr√•de med klickbar l√§nk tillbaka till startsidan -->
            <div class="logotype">
                <h1><a href="/" style="text-decoration: none; color: inherit;">logotype</a></h1>
            </div>
            
            <!-- Handlingsomr√•de med s√∂kf√§lt och knappar -->
            <div class="actions">
                <!-- S√∂kf√§lt f√∂r produkts√∂kning -->
                <div class="search-bar">
                    <input class="input" type="text" placeholder="S√∂k produkt...">
                    <button type="submit" aria-label="Search">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <!-- Handlingsknappar f√∂r √∂nskelista och varukorg -->
                <div class="action-buttons">
                    <a href="#" aria-label="Wishlist">
                        <i class="fas fa-heart"></i>
                    </a>
                    <a href="/basket" aria-label="Shopping Basket">
                        <i class="fas fa-shopping-basket"></i>
                    </a>
                </div>
            </div>
        </header>
        
        <!-- NAVIGATIONSSEKTION: Huvudnavigering f√∂r olika produktkategorier -->
        <ul class="navigation-list">
            <li><a href="/" style="text-decoration: none; color: inherit;">Hem</a></li>
            <li>Nyheter</li>
            <li>B√§sts√§ljare</li>
            <li>Kvinnor</li>
            <li>M√§n</li>
        </ul>

        <!-- HUVUDINNEH√ÖLL: Varukorgssidans inneh√•ll -->
        <main class="basket-main">
            <h1>Varukorg</h1>

            <!-- TOM VARUKORG-TILLST√ÖND: Visas n√§r inga produkter finns i varukorgen -->
            <div id="empty-basket" class="empty-basket" style="display: none;">
                <div class="empty-basket-content">
                    <!-- Stor varukorg-ikon f√∂r visuell feedback -->
                    <i class="fas fa-shopping-basket empty-basket-icon"></i>
                    <h2>Din varukorg √§r tom</h2>
                    <p>L√§gg till produkter f√∂r att forts√§tta med ditt k√∂p</p>
                    
                    <!-- Knapp f√∂r att g√• tillbaka till shopping -->
                    <a href="/" class="continue-shopping-btn">Forts√§tt handla</a>
                </div>
            </div>

            <!-- VARUKORGSINNEH√ÖLL: Visas n√§r det finns produkter i varukorgen -->
            <div id="basket-content" class="basket-content">
                
                <!-- PRODUKTTABELL: Visar alla produkter i tabellformat -->
                <div class="basket-table-container">
                    <table class="basket-table">
                        <!-- Tabellhuvud med kolumnrubriker -->
                        <thead>
                            <tr>
                                <th>Produkt</th>       <!-- Produktnamn, bild och m√§rke -->
                                <th>Pris</th>          <!-- Styckpris -->
                                <th>Antal</th>         <!-- Kvantitet med +/- knappar -->
                                <th>Totalt</th>        <!-- Pris √ó antal -->
                                <th>√Ötg√§rd</th>        <!-- Ta bort-knapp -->
                            </tr>
                        </thead>
                        
                        <!-- Tabellkropp som fylls dynamiskt av JavaScript -->
                        <tbody id="basket-items">
                            <!-- Varukorgsartiklar laddas dynamiskt h√§r av BasketManager -->
                        </tbody>
                    </table>
                </div>

                <!-- VARUKORGSAMMANDRAG: Totaler och kassaknapp -->
                <div class="basket-summary">
                    <!-- Delsumma (alla produkter tillsammans) -->
                    <div class="summary-row">
                        <span>Delsumma:</span>
                        <span id="subtotal">0 SEK</span>
                    </div>
                    
                    <!-- Fraktkostnad (gratis √∂ver 500 SEK) -->
                    <div class="summary-row">
                        <span>Frakt:</span>
                        <span id="shipping">Gratis</span>
                    </div>
                    
                    <!-- Totalsumma (delsumma + frakt) -->
                    <div class="summary-row total-row">
                        <span>Totalt:</span>
                        <span id="total">0 SEK</span>
                    </div>
                    
                    <!-- Handlingsknappar -->
                    <div class="basket-actions">
                        <!-- Sekund√§r knapp: Forts√§tt handla -->
                        <button class="continue-shopping-btn secondary" onclick="window.location.href='/'">
                            Forts√§tt handla
                        </button>
                        
                        <!-- Prim√§r knapp: G√• till kassan -->
                        <button class="checkout-btn primary" id="checkout-btn">
                            Till kassan
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- F√ñRDELAR-SEKTION: Visar butikens f√∂rdelar och tj√§nster -->
        <div class="perks-wrapper">
            <!-- F√∂rdel 1: Gratis frakt och returer -->
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-earth-americas"></i>
                </div>
                <div class="perk-text">
                    Gratis frakt och returer
                </div>
            </div>
            
            <!-- F√∂rdel 2: Expressfrakt -->
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-truck-fast"></i>
                </div>
                <div class="perk-text">
                    Expressfrakt
                </div>
            </div>
            
            <!-- F√∂rdel 3: S√§kra betalningar -->
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-shield"></i>
                </div>
                <div class="perk-text">
                    S√§kra betalningar
                </div>
            </div>
            
            <!-- F√∂rdel 4: Dagliga nyheter -->
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-face-smile"></i>
                </div>
                <div class="perk-text">
                    Nyheter varje dag
                </div>
            </div>
        </div>

        <!-- ACCORDION-SEKTION: Utf√§llbara menyer f√∂r mobil navigation -->
        <div class="accordions">
            <!-- Accordion 1: Shopping-kategorier -->
            <div class="accordion-wrapper">
                <button class="accordion">Shopping</button>
                <div class="panel">
                    <p class="panel-item">Vinterjackor</p>
                    <p class="panel-item">Pufferjackor</p>
                    <p class="panel-item">Kappa</p>
                    <p class="panel-item">Trenchcoats</p>
                </div>
            </div>

            <!-- Accordion 2: Mina sidor-funktioner -->
            <div class="accordion-wrapper">
                <button class="accordion">Mina sidor</button>
                <div class="panel">
                    <p class="panel-item">Mina Ordrar</p>
                    <p class="panel-item">Mitt konto</p>
                </div>
            </div>

            <!-- Accordion 3: Kundtj√§nst-alternativ -->
            <div class="accordion-wrapper">
                <button class="accordion">Kundtj√§nst</button>
                <div class="panel">
                    <p class="panel-item">Kontakta oss</p>
                    <p class="panel-item">Hitta hit</p>
                </div>
            </div>
        </div>

        <!-- FOOTER-SEKTION: Enkel copyright-information -->
        <footer>
            &#169; FakeShop
        </footer>
    </div>

    <!-- JAVASCRIPT-SEKTION: All funktionalitet f√∂r varukorgssidan -->
    <script>
        // ====================================================================
        // BASKETMANAGER-KLASS: HUVUDKLASS F√ñR ALLA VARUKORGSFUNKTIONER
        // ====================================================================
        
        /**
         * BasketManager - Klass som hanterar alla varukorgsfunktioner
         * Ansvarar f√∂r localStorage-hantering, kvantitetsuppdateringar, 
         * ber√§kningar och UI-rendering
         */
        class BasketManager {
            /**
             * Konstruktor som initialiserar BasketManager
             * Laddar befintlig varukorg och startar rendering
             */
            constructor() {
                // Ladda befintliga varukorgsartiklar fr√•n localStorage
                this.items = this.loadBasket();
                console.log('üõí BasketManager initialiserad med', this.items.length, 'artiklar');
                
                // Initiera rendering och event listeners
                this.init();
            }

            // ================================================================
            // LOCALSTORAGE-HANTERING: LADDA OCH SPARA VARUKORG
            // ================================================================
            
            /**
             * Ladda varukorg fr√•n localStorage
             * @returns {Array} Array med varukorgsartiklar, tom array om inget finns
             */
            loadBasket() {
                // F√∂rs√∂k h√§mta varukorg fr√•n localStorage
                const basket = localStorage.getItem('fakeShopBasket');
                
                // Parsea JSON-data om den finns, annars returnera tom array
                return basket ? JSON.parse(basket) : [];
            }

            /**
             * Spara varukorg till localStorage
             * Konverterar items-array till JSON och sparar den
             */
            saveBasket() {
                // Spara aktuella items som JSON-str√§ng i localStorage
                localStorage.setItem('fakeShopBasket', JSON.stringify(this.items));
                console.log('üíæ Varukorg sparad i localStorage');
            }

            // ================================================================
            // PRODUKTHANTERING: L√ÑGG TILL, UPPDATERA OCH TA BORT
            // ================================================================
            
            /**
             * L√§gg till produkt i varukorg
             * Om produkten redan finns, √∂ka kvantiteten. Annars l√§gg till ny.
             * @param {Object} product - Produktobjekt att l√§gga till
             * @param {number} quantity - Antal att l√§gga till (standard: 1)
             */
            addItem(product, quantity = 1) {
                console.log('‚ûï L√§gger till produkt:', product.name, 'antal:', quantity);
                
                // Leta efter befintlig produkt med samma ID
                const existingItem = this.items.find(item => item.id === product.id);
                
                if (existingItem) {
                    // Om produkten redan finns, √∂ka kvantiteten
                    existingItem.quantity += quantity;
                    console.log('üîÑ Uppdaterade kvantitet f√∂r befintlig produkt');
                } else {
                    // Om produkten √§r ny, l√§gg till i items-array
                    this.items.push({
                        id: product.id,                    // Unikt produkt-ID
                        name: product.name,                // Produktnamn
                        brand: product.brand,              // Produktm√§rke
                        price: product.price,              // Styckpris
                        image_url: product.image_url,      // Produktbild
                        quantity: quantity                 // Antal i varukorgen
                    });
                    console.log('‚úÖ Lade till ny produkt i varukorgen');
                }
                
                // Spara till localStorage och uppdatera UI
                this.saveBasket();
                this.render();
                console.log('‚úÖ Produkt tillagd i varukorg:', product.name);
            }

            /**
             * Uppdatera kvantitet f√∂r en specifik produkt
             * @param {number} productId - ID f√∂r produkten att uppdatera
             * @param {number} newQuantity - Ny kvantitet (om ‚â§0 tas produkten bort)
             */
            updateQuantity(productId, newQuantity) {
                console.log('üî¢ Uppdaterar kvantitet f√∂r produkt ID:', productId, 'till:', newQuantity);
                
                // Om kvantiteten √§r 0 eller mindre, ta bort produkten helt
                if (newQuantity <= 0) {
                    this.removeItem(productId);
                    return;
                }

                // Hitta produkten i items-array
                const item = this.items.find(item => item.id === productId);
                if (item) {
                    // Uppdatera kvantiteten
                    item.quantity = newQuantity;
                    console.log('‚úÖ Kvantitet uppdaterad f√∂r:', item.name);
                    
                    // Spara och rendera om
                    this.saveBasket();
                    this.render();
                } else {
                    console.log('‚ö†Ô∏è Kunde inte hitta produkt med ID:', productId);
                }
            }

            /**
             * Ta bort produkt helt fr√•n varukorg
             * @param {number} productId - ID f√∂r produkten att ta bort
             */
            removeItem(productId) {
                console.log('üóëÔ∏è Tar bort produkt med ID:', productId);
                
                // Filtrera bort produkten med angivet ID
                const itemToRemove = this.items.find(item => item.id === productId);
                this.items = this.items.filter(item => item.id !== productId);
                
                if (itemToRemove) {
                    console.log('‚úÖ Produkt borttagen:', itemToRemove.name);
                } else {
                    console.log('‚ö†Ô∏è Kunde inte hitta produkt att ta bort med ID:', productId);
                }
                
                // Spara och rendera om
                this.saveBasket();
                this.render();
                console.log('‚úÖ Produkt borttagen fr√•n varukorg');
            }

            // ================================================================
            // BER√ÑKNINGAR: TOTALER, FRAKT OCH DELSUMMOR
            // ================================================================
            
            /**
             * R√§kna ut alla totaler f√∂r varukorgen
             * Ber√§knar delsumma, frakt och totalsumma
             * @returns {Object} Objekt med subtotal, shipping och total
             */
            calculateTotals() {
                // Ber√§kna delsumma: summa av (pris √ó kvantitet) f√∂r alla produkter
                const subtotal = this.items.reduce((sum, item) => {
                    return sum + (item.price * item.quantity);
                }, 0);
                
                // Ber√§kna frakt: Gratis √∂ver 500 SEK, 49 SEK annars (0 om tom korg)
                const shipping = subtotal > 500 ? 0 : (subtotal > 0 ? 49 : 0);
                
                // Ber√§kna totalsumma
                const total = subtotal + shipping;

                console.log('üí∞ Totaler ber√§knade - Delsumma:', subtotal, 'Frakt:', shipping, 'Totalt:', total);
                
                // Returnera alla ber√§knade v√§rden
                return { subtotal, shipping, total };
            }

            // ================================================================
            // UI-RENDERING: UPPDATERA VARUKORGSDISPLAY
            // ================================================================
            
            /**
             * Rendera hela varukorgen i UI:et
             * Hanterar tom varukorg, produktlista och totaler
             */
            render() {
                console.log('üé® Renderar varukorg med', this.items.length, 'artiklar');
                
                // H√§mta referenser till DOM-element
                const emptyBasket = document.getElementById('empty-basket');
                const basketContent = document.getElementById('basket-content');
                const basketItems = document.getElementById('basket-items');

                // ============================================================
                // HANTERA TOM VARUKORG
                // ============================================================
                
                if (this.items.length === 0) {
                    // Visa tom varukorg-meddelande
                    emptyBasket.style.display = 'block';
                    basketContent.style.display = 'none';
                    console.log('üì≠ Visar tom varukorg');
                    return;
                }

                // ============================================================
                // VISA VARUKORG MED INNEH√ÖLL
                // ============================================================
                
                // D√∂lj tom varukorg-meddelande och visa inneh√•ll
                emptyBasket.style.display = 'none';
                basketContent.style.display = 'block';

                // ============================================================
                // RENDERA ALLA VARUKORGSARTIKLAR
                // ============================================================
                
                // Skapa HTML f√∂r varje artikel i varukorgen
                basketItems.innerHTML = this.items.map(item => `
                    <tr class="basket-item">
                        <!-- Produktinformation: bild, namn och m√§rke -->
                        <td class="item-info">
                            <img src="${item.image_url}" alt="${item.name}" class="item-image">
                            <div class="item-details">
                                <h3>${item.name}</h3>
                                <p>${item.brand}</p>
                            </div>
                        </td>
                        
                        <!-- Styckpris -->
                        <td class="item-price">${item.price} SEK</td>
                        
                        <!-- Kvantitetskontroller med +/- knappar -->
                        <td class="item-quantity">
                            <div class="quantity-controls">
                                <!-- Minska kvantitet-knapp -->
                                <button class="quantity-btn" onclick="basket.updateQuantity(${item.id}, ${item.quantity - 1})">
                                    <i class="fas fa-minus"></i>
                                </button>
                                
                                <!-- Kvantitetsinput-f√§lt -->
                                <input type="number" value="${item.quantity}" min="1" 
                                       onchange="basket.updateQuantity(${item.id}, parseInt(this.value))"
                                       class="quantity-input">
                                
                                <!-- √ñka kvantitet-knapp -->
                                <button class="quantity-btn" onclick="basket.updateQuantity(${item.id}, ${item.quantity + 1})">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </td>
                        
                        <!-- Totalpris f√∂r denna artikel (pris √ó kvantitet) -->
                        <td class="item-total">${item.price * item.quantity} SEK</td>
                        
                        <!-- Ta bort-knapp -->
                        <td class="item-actions">
                            <button class="remove-btn" onclick="basket.removeItem(${item.id})" title="Ta bort">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');

                // ============================================================
                // UPPDATERA TOTALER I SAMMANDRAG
                // ============================================================
                
                // Ber√§kna och visa alla totaler
                const { subtotal, shipping, total } = this.calculateTotals();
                
                // Uppdatera delsumma
                document.getElementById('subtotal').textContent = `${subtotal} SEK`;
                
                // Uppdatera frakt (visa "Gratis" eller belopp)
                document.getElementById('shipping').textContent = shipping === 0 ? 'Gratis' : `${shipping} SEK`;
                
                // Uppdatera totalsumma
                document.getElementById('total').textContent = `${total} SEK`;
                
                console.log('‚úÖ Varukorg renderad med uppdaterade totaler');
            }

            // ================================================================
            // INITIALISERING: STARTA ALLA FUNKTIONER
            // ================================================================
            
            /**
             * Initiera BasketManager
             * Renderar initial UI och s√§tter upp event listeners
             */
            init() {
                console.log('üîß Initialiserar BasketManager...');
                
                // Rendera initial varukorg
                this.render();
                
                // ============================================================
                // KASSAKNAPP EVENT LISTENER
                // ============================================================
                
                // L√§gg till click-lyssnare f√∂r kassaknappen
                document.getElementById('checkout-btn').addEventListener('click', () => {
                    console.log('üõí Kassaknapp klickad');
                    
                    // Kontrollera att det finns produkter innan vi g√•r till kassan
                    if (this.items.length > 0) {
                        console.log('‚úÖ Navigerar till kassan med', this.items.length, 'produkter');
                        window.location.href = '/checkout.html';
                    } else {
                        console.log('‚ö†Ô∏è Kan inte g√• till kassan - tom varukorg');
                        alert('Din varukorg √§r tom! L√§gg till produkter f√∂rst.');
                    }
                });
                
                console.log('‚úÖ BasketManager initialiserad');
            }
        }

        // ====================================================================
        // HUVUDINITIALISERING: STARTA ALLT N√ÑR DOM:EN √ÑR LADDAD
        // ====================================================================
        
        /**
         * DOMContentLoaded event listener som initialiserar hela sidan
         * Startar BasketManager och accordion-funktionalitet
         */
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ Varukorgssida laddad, initialiserar...');
            
            // ================================================================
            // INITIERA VARUKORG
            // ================================================================
            
            // Skapa global BasketManager-instans
            window.basket = new BasketManager();
            
            // ================================================================
            // ACCORDION-FUNKTIONALITET F√ñR MOBIL NAVIGATION
            // ================================================================
            
            // H√§mta alla accordion-knappar
            var acc = document.getElementsByClassName("accordion");
            
            // L√§gg till click-lyssnare f√∂r varje accordion
            for (let i = 0; i < acc.length; i++) {
                acc[i].addEventListener("click", function () {
                    console.log('üîÑ Accordion klickad:', this.textContent);
                    
                    // V√§xla "active"-klassen p√• knappen
                    this.classList.toggle("active");
                    
                    // Hitta tillh√∂rande panel (n√§sta element)
                    var panel = this.nextElementSibling;
                    
                    // V√§xla panelens synlighet
                    if (panel.style.display === "block") {
                        panel.style.display = "none";  // D√∂lj panelen
                        console.log('üì§ St√§ngde accordion-panel');
                    } else {
                        panel.style.display = "block"; // Visa panelen
                        console.log('üì• √ñppnade accordion-panel');
                    }
                });
            }
        });

        // ====================================================================
        // TESTFUNKTIONER: F√ñR UTVECKLING OCH FELS√ñKNING
        // ====================================================================
        
        /**
         * L√§gg till testprodukter i varukorgen f√∂r utveckling/fels√∂kning
         * VIKTIGT: Denna funktion ska tas bort eller kommenteras bort i produktion
         */
        function addTestItems() {
            console.log('üß™ L√§gger till testprodukter...');
            
            // Testprodukt 1: Premium T-shirt
            const testProduct1 = {
                id: 1,                              // Unikt produkt-ID
                name: "Premium T-shirt",            // Produktnamn
                brand: "Levis",                     // M√§rke
                price: 249,                         // Pris i SEK
                image_url: "/images/product.png"    // Produktbild
            };
            
            // Testprodukt 2: Bl√• Jeans
            const testProduct2 = {
                id: 33,                             // Unikt produkt-ID
                name: "Bl√• Jeans",                  // Produktnamn
                brand: "Levis",                     // M√§rke
                price: 599,                         // Pris i SEK
                image_url: "/images/product.png"    // Produktbild
            };
            
            // L√§gg till testprodukterna i varukorgen
            basket.addItem(testProduct1, 2);  // 2 st T-shirts
            basket.addItem(testProduct2, 1);  // 1 st jeans
            
            console.log('‚úÖ Testprodukter tillagda');
        }
        
        // Ovanst√•ende funktion kan anropas f√∂r att testa funktionaliteten:
        // addTestItems(); // Avkommentera denna rad f√∂r att l√§gga till testdata
    </script>
</body>

</html>
