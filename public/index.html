<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FakeShop | Startsida</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
    <div class="wrapper">
        <header class="header">
            <div class="logotype">
                <h1>logotype</h1>
            </div>
            <div class="actions">
                <div class="search-bar">
                    <input class="input" type="text" placeholder="Search products...">
                    <button type="submit" aria-label="Search"> 
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="action-buttons">
                    <a href="#" aria-label="Wishlist"> 
                        <i class="fas fa-heart"></i>
                    </a>
                    <a href="/basket.html" aria-label="Shopping Basket">
                        <i class="fas fa-shopping-basket"></i>
                    </a>
                </div>
            </div>
        </header>
        <ul class="navigation-list">
            <li>Nyheter</li>
            <li>B√§sts√§ljare</li>
            <li>Kvinnor</li>
            <li>M√§n</li>
        </ul>
        <div class="hero">
            <div class="hero-image">
                <img src="./images/placeholder-hero.jpg" alt="heroPlaceholder">
            </div>
            <div class="hero-text">
                <h2>
                    Lorem ipsum dolor sit amet
                </h2>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eligendi non quis exercitationem culpa
                    nesciunt nihil aut nostrum explicabo.
                </p>
            </div>
        </div>

        <!-- S√∂kresultat text (ny sektion) -->
        <div id="search-results-info" style="display: none; text-align: center; padding: 20px 0; font-size: 18px; color: #666; font-weight: 500;">
            <!-- S√∂kresultat text visas h√§r -->
        </div>

        <div class="products-wrapper" id="products-container">
            <!-- Produkter laddas dynamiskt h√§r -->
            <div class="loading-message">Laddar produkter...</div>
        </div>

        <div class="perks-wrapper">
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-earth-americas"></i>
                </div>
                <div class="perk-text">
                    Gratis frakt och returer
                </div>
            </div>
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-truck-fast"></i>
                </div>
                <div class="perk-text">
                    Expressfrakt
                </div>
            </div>
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-shield"></i>
                </div>
                <div class="perk-text">
                    S√§kra betalningar
                </div>
            </div>
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-face-smile"></i>
                </div>
                <div class="perk-text">
                    Nyheter varje dag
                </div>
            </div>
        </div>

        <div class="accordions">

            <div class="accordion-wrapper">
                <button class="accordion">
                    Shopping
                </button>
                <div class="panel">
                    <p class="panel-item">Vinterjackor</p>
                    <p class="panel-item">Pufferjackor</p>
                    <p class="panel-item">Koppa</p>
                    <p class="panel-item">Trenchcoats</p>
                </div>
            </div>
    
            <div class="accordion-wrapper">
                <button class="accordion">
                    Mina sidor
                </button>
                <div class="panel">
                    <p class="panel-item">Mina Ordrar</p>
                    <p class="panel-item">Mitt konto</p>
                </div>
            </div>
    
            <div class="accordion-wrapper">
                <button class="accordion">
                    Kundtj√§nst
                </button>
                <div class="panel">
                    <p class="panel-item">Kontakta oss</p>
                    <p class="panel-item">Hitta hit</p>
                </div>
            </div>
        </div>

        <footer>
            &#169; FakeShop
        </footer>
    </div>

    <script>
        var acc = document.getElementsByClassName("accordion");
        var i;

        for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function () {
                /* Toggle between adding and removing the "active" class,
                to highlight the button that controls the panel */
                this.classList.toggle("active");

                /* Toggle between hiding and showing the active panel */
                var panel = this.nextElementSibling;
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                } else {
                    panel.style.display = "block";
                }
            });
        }
    </script>

    <script>
    let allProducts = []; // Lagra alla produkter f√∂r snabb filtrering
    let currentSearchQuery = ''; // H√•ll koll p√• aktuell s√∂kning

    // H√§mta produkter fr√•n API:et
    async function fetchProducts() {
        try {
            console.log('üîÑ H√§mtar produkter fr√•n API...');
            const response = await fetch('/api/products');
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const products = await response.json();
            console.log('‚úÖ Produkter h√§mtade:', products.length);
            
            allProducts = products; // Spara f√∂r s√∂kning
            displayProducts(products);
        } catch (error) {
            console.error('‚ùå Fel vid h√§mtning av produkter:', error);
            document.getElementById('products-container').innerHTML = 
                '<div class="error-message">Kunde inte ladda produkter. F√∂rs√∂k igen senare.</div>';
        }
    }

    // S√∂k produkter lokalt (snabbare)
    function searchProducts(query) {
        currentSearchQuery = query;
        
        if (!query || query.trim() === '') {
            hideSearchResults();
            displayProducts(allProducts);
            return;
        }
        
        const searchTerm = query.toLowerCase().trim();
        const filteredProducts = allProducts.filter(product => 
            product.name.toLowerCase().includes(searchTerm) ||
            product.brand.toLowerCase().includes(searchTerm) ||
            (product.description && product.description.toLowerCase().includes(searchTerm))
        );
        
        console.log(`üîç S√∂kning "${query}" gav ${filteredProducts.length} resultat`);
        showSearchResults(filteredProducts.length, query);
        displayProducts(filteredProducts);
    }

    // Visa s√∂kresultat information
    function showSearchResults(count, query) {
        const searchInfo = document.getElementById('search-results-info');
        searchInfo.textContent = `Hittade ${count} produkter`;
        searchInfo.style.display = 'block';
    }

    // D√∂lj s√∂kresultat information
    function hideSearchResults() {
        const searchInfo = document.getElementById('search-results-info');
        searchInfo.style.display = 'none';
    }

    // Kontrollera om en produkt √§r ny (skapad inom 7 dagar)
    function isNewProduct(createdAt) {
        const now = new Date();
        const productDate = new Date(createdAt);
        const daysDifference = Math.floor((now - productDate) / (1000 * 60 * 60 * 24));
        
        return daysDifference <= 7;
    }

    // Visa produkter p√• sidan
    function displayProducts(products) {
        const container = document.getElementById('products-container');
        
        if (products.length === 0) {
            const message = currentSearchQuery 
                ? `Inga produkter hittades f√∂r "${currentSearchQuery}"`
                : 'Inga produkter hittades.';
            container.innerHTML = `<div class="no-products">${message}</div>`;
            return;
        }
        
        // Skapa HTML f√∂r alla produkter
        const productsHTML = products.map(product => {
            const isNew = isNewProduct(product.created_at);
            
            return `
                <div class="product-card" data-product-id="${product.id}" title="Klicka f√∂r att se detaljer">
                    <div class="product-image">
                        <img src="${product.image_url}" alt="${product.name}">
                        <div class="product-overlay overlay-heart">
                            &#x2764;
                        </div>
                        ${isNew ? '<div class="product-overlay overlay-banner">Nyhet</div>' : ''}
                    </div>
                    <div class="product-info">
                        <div class="product-info-name">
                            <h3>${product.name}</h3>
                            <p>${product.brand}</p>
                        </div>
                        <div class="product-info-price">${product.price} SEK</div>
                    </div>
                </div>
            `;
        }).join('');
        
        container.innerHTML = productsHTML;
        console.log('‚úÖ Produkter visade p√• sidan');
    }

    // Hantera s√∂kfunktionalitet
    function setupSearch() {
        const searchInput = document.querySelector('.search-bar .input');
        const searchButton = document.querySelector('.search-bar button');
        
        // S√∂k medan anv√§ndaren skriver (med f√∂rdr√∂jning)
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                searchProducts(this.value);
            }, 300); // V√§nta 300ms efter anv√§ndaren slutat skriva
        });
        
        // S√∂k n√§r knappen klickas
        searchButton.addEventListener('click', function(e) {
            e.preventDefault();
            searchProducts(searchInput.value);
        });
        
        // S√∂k n√§r Enter trycks
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                searchProducts(this.value);
            }
        });
        
        console.log('‚úÖ S√∂kfunktionalitet aktiverad');
    }

    // L√§gg till klickh√§ndelse f√∂r produktkort
    function addProductClickListeners() {
        document.addEventListener('click', function(e) {
            const productCard = e.target.closest('.product-card');
            if (productCard) {
                const productId = productCard.dataset.productId;
                console.log('üñ±Ô∏è Produkt klickad, ID:', productId);
                // Navigera till produktsidan med produkt-ID
                window.location.href = `/product-details.html?id=${productId}`;
            }
        });
    }

    // K√∂r n√§r sidan har laddats
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üìÑ Sida laddad, h√§mtar produkter...');
        fetchProducts();
        setupSearch();
        addProductClickListeners();
    });
    </script>
</body>

</html>