<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta-taggar f√∂r dokumenttyp och responsiv design -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Sidans titel som visas i webbl√§sarens flik -->
    <title>FakeShop | Startsida</title>
    
    <!-- Externa CSS-bibliotek f√∂r ikoner (Font Awesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Lokal CSS f√∂r grundl√§ggande styling av hela sidan -->
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
    <!-- Huvudwrapper som omsluter hela sidans inneh√•ll -->
    <div class="wrapper">
        
        <!-- HEADER-SEKTION: Inneh√•ller logotyp och navigationsverktyg -->
        <header class="header">
            <!-- Logotypomr√•de -->
            <div class="logotype">
                <h1>logotype</h1>
            </div>
            
            <!-- Handlingsomr√•de med s√∂kf√§lt och knappar -->
            <div class="actions">
                <!-- S√∂kf√§lt f√∂r produkts√∂kning -->
                <div class="search-bar">
                    <input class="input" type="text" placeholder="Search products...">
                    <button type="submit" aria-label="Search"> 
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <!-- Handlingsknappar f√∂r √∂nskelista och varukorg -->
                <div class="action-buttons">
                    <!-- √ñnskelista-knapp (endast visuell, ej implementerad funktionalitet) -->
                    <a href="#" aria-label="Wishlist"> 
                        <i class="fas fa-heart"></i>
                    </a>
                    <!-- Varukorg-knapp som navigerar till varukorgssidan -->
                    <a href="/basket.html" aria-label="Shopping Basket">
                        <i class="fas fa-shopping-basket"></i>
                    </a>
                </div>
            </div>
        </header>
        
        <!-- NAVIGATIONSSEKTION: Huvudnavigering f√∂r olika produktkategorier -->
        <ul class="navigation-list">
            <li>Nyheter</li>
            <li>B√§sts√§ljare</li>
            <li>Kvinnor</li>
            <li>M√§n</li>
        </ul>
        
        <!-- HERO-SEKTION: Stor marknadsf√∂ringssektion med bild och text -->
        <div class="hero">
            <!-- Hero-bild -->
            <div class="hero-image">
                <img src="./images/placeholder-hero.jpg" alt="heroPlaceholder">
            </div>
            
            <!-- Hero-text med huvudmeddelande -->
            <div class="hero-text">
                <h2>
                    Lorem ipsum dolor sit amet
                </h2>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eligendi non quis exercitationem culpa
                    nesciunt nihil aut nostrum explicabo.
                </p>
            </div>
        </div>

        <!-- S√ñKRESULTAT-INFO: Visar antal s√∂kresultat (dolt som standard) -->
        <div id="search-results-info" style="display: none; text-align: center; padding: 20px 0; font-size: 18px; color: #666; font-weight: 500;">
            <!-- S√∂kresultat text visas h√§r dynamiskt via JavaScript -->
        </div>

        <!-- PRODUKTCONTAINER: H√§r renderas alla produkter dynamiskt -->
        <div class="products-wrapper" id="products-container">
            <!-- Laddningsmeddelande som visas medan produkter h√§mtas -->
            <div class="loading-message">Laddar produkter...</div>
        </div>

        <!-- F√ñRDELAR-SEKTION: Visar butikens f√∂rdelar och tj√§nster -->
        <div class="perks-wrapper">
            <!-- F√∂rdel 1: Gratis frakt och returer -->
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-earth-americas"></i>
                </div>
                <div class="perk-text">
                    Gratis frakt och returer
                </div>
            </div>
            
            <!-- F√∂rdel 2: Expressfrakt -->
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-truck-fast"></i>
                </div>
                <div class="perk-text">
                    Expressfrakt
                </div>
            </div>
            
            <!-- F√∂rdel 3: S√§kra betalningar -->
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-shield"></i>
                </div>
                <div class="perk-text">
                    S√§kra betalningar
                </div>
            </div>
            
            <!-- F√∂rdel 4: Dagliga nyheter -->
            <div class="perk-item">
                <div class="perk-icon">
                    <i class="fa-solid fa-face-smile"></i>
                </div>
                <div class="perk-text">
                    Nyheter varje dag
                </div>
            </div>
        </div>

        <!-- ACCORDION-SEKTION: Utf√§llbara menyer f√∂r additional navigation -->
        <div class="accordions">

            <!-- Accordion 1: Shopping-kategorier -->
            <div class="accordion-wrapper">
                <button class="accordion">
                    Shopping
                </button>
                <div class="panel">
                    <p class="panel-item">Vinterjackor</p>
                    <p class="panel-item">Pufferjackor</p>
                    <p class="panel-item">Koppa</p>
                    <p class="panel-item">Trenchcoats</p>
                </div>
            </div>
    
            <!-- Accordion 2: Mina sidor-funktioner -->
            <div class="accordion-wrapper">
                <button class="accordion">
                    Mina sidor
                </button>
                <div class="panel">
                    <p class="panel-item">Mina Ordrar</p>
                    <p class="panel-item">Mitt konto</p>
                </div>
            </div>
    
            <!-- Accordion 3: Kundtj√§nst-alternativ -->
            <div class="accordion-wrapper">
                <button class="accordion">
                    Kundtj√§nst
                </button>
                <div class="panel">
                    <p class="panel-item">Kontakta oss</p>
                    <p class="panel-item">Hitta hit</p>
                </div>
            </div>
        </div>

        <!-- FOOTER-SEKTION: Enkel copyright-information -->
        <footer>
            &#169; FakeShop
        </footer>
    </div>

    <!-- JAVASCRIPT-SEKTION: Accordion-funktionalitet f√∂r mobil navigation -->
    <script>
        // ====================================================================
        // ACCORDION-FUNKTIONALITET
        // ====================================================================
        
        // H√§mta alla accordion-knappar fr√•n DOM:en
        var acc = document.getElementsByClassName("accordion");
        var i;

        // Loopa igenom alla accordion-knappar och l√§gg till click-lyssnare
        for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function () {
                // V√§xla "active"-klassen f√∂r att highlighta aktiv knapp
                this.classList.toggle("active");

                // Hitta panelen som h√∂r till denna knapp och v√§xla synlighet
                var panel = this.nextElementSibling;
                if (panel.style.display === "block") {
                    panel.style.display = "none";  // D√∂lj panelen
                } else {
                    panel.style.display = "block"; // Visa panelen
                }
            });
        }
    </script>

    <!-- JAVASCRIPT-SEKTION: Huvudfunktionalitet f√∂r produktvisning och s√∂kning -->
    <script>
    // ====================================================================
    // GLOBALA VARIABLER F√ñR PRODUKTHANTERING
    // ====================================================================
    
    // Array f√∂r att lagra alla produkter fr√•n API:et f√∂r snabb lokal filtrering
    let allProducts = [];
    
    // H√•ller koll p√• aktuell s√∂kfr√•ga f√∂r att visa r√§tt meddelanden
    let currentSearchQuery = '';

    // ====================================================================
    // API-KOMMUNIKATION: H√ÑMTA PRODUKTER FR√ÖN BACKEND
    // ====================================================================
    
    /**
     * H√§mta alla produkter fr√•n API:et
     * Denna funktion k√∂rs n√§r sidan laddas och h√§mtar alla tillg√§ngliga produkter
     */
    async function fetchProducts() {
        try {
            console.log('üîÑ H√§mtar produkter fr√•n API...');
            
            // Skicka GET-request till produkter-API:et
            const response = await fetch('/api/products');
            
            // Kontrollera att requestet var framg√•ngsrikt
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            // Parsea JSON-svaret
            const products = await response.json();
            console.log('‚úÖ Produkter h√§mtade:', products.length);
            
            // Spara produkterna globalt f√∂r s√∂kning och visa dem
            allProducts = products;
            displayProducts(products);
            
        } catch (error) {
            // Hantera fel vid h√§mtning och visa felmeddelande
            console.error('‚ùå Fel vid h√§mtning av produkter:', error);
            document.getElementById('products-container').innerHTML = 
                '<div class="error-message">Kunde inte ladda produkter. F√∂rs√∂k igen senare.</div>';
        }
    }

    // ====================================================================
    // S√ñKFUNKTIONALITET: LOKAL FILTRERING AV PRODUKTER
    // ====================================================================
    
    /**
     * S√∂k produkter lokalt (snabbare √§n API-anrop)
     * Filtrerar produkter baserat p√• namn, m√§rke eller beskrivning
     * 
     * @param {string} query - S√∂kterm fr√•n anv√§ndaren
     */
    function searchProducts(query) {
        // Spara aktuell s√∂kfr√•ga
        currentSearchQuery = query;
        
        // Om s√∂kning √§r tom, visa alla produkter och d√∂lj s√∂kresultat-info
        if (!query || query.trim() === '') {
            hideSearchResults();
            displayProducts(allProducts);
            return;
        }
        
        // Konvertera s√∂kterm till gemener f√∂r case-insensitive s√∂kning
        const searchTerm = query.toLowerCase().trim();
        
        // Filtrera produkter som matchar s√∂ktermen i namn, m√§rke eller beskrivning
        const filteredProducts = allProducts.filter(product => 
            product.name.toLowerCase().includes(searchTerm) ||
            product.brand.toLowerCase().includes(searchTerm) ||
            (product.description && product.description.toLowerCase().includes(searchTerm))
        );
        
        // Logga s√∂kresultat och visa dem
        console.log(`üîç S√∂kning "${query}" gav ${filteredProducts.length} resultat`);
        showSearchResults(filteredProducts.length, query);
        displayProducts(filteredProducts);
    }

    // ====================================================================
    // UI-FUNKTIONER F√ñR S√ñKRESULTAT
    // ====================================================================
    
    /**
     * Visa information om s√∂kresultat
     * 
     * @param {number} count - Antal hittade produkter
     * @param {string} query - S√∂kterm som anv√§ndes
     */
    function showSearchResults(count, query) {
        const searchInfo = document.getElementById('search-results-info');
        searchInfo.textContent = `Hittade ${count} produkter`;
        searchInfo.style.display = 'block';
    }

    /**
     * D√∂lj s√∂kresultat-information
     * Anv√§nds n√§r s√∂kning rensas eller inga s√∂ktermer anges
     */
    function hideSearchResults() {
        const searchInfo = document.getElementById('search-results-info');
        searchInfo.style.display = 'none';
    }

    // ====================================================================
    // PRODUKTLOGIK: KONTROLLERA OM PRODUKT √ÑR NY
    // ====================================================================
    
    /**
     * Kontrollera om en produkt √§r ny (skapad inom 7 dagar)
     * Anv√§nds f√∂r att visa "Nyhet"-m√§rkning p√• produktkort
     * 
     * @param {string} createdAt - Produktens skapandedatum fr√•n databasen
     * @returns {boolean} True om produkten √§r ny, annars false
     */
    function isNewProduct(createdAt) {
        const now = new Date();
        const productDate = new Date(createdAt);
        
        // Ber√§kna skillnad i dagar mellan nu och skapandedatum
        const daysDifference = Math.floor((now - productDate) / (1000 * 60 * 60 * 24));
        
        // Produkten √§r "ny" om den skapades inom 7 dagar
        return daysDifference <= 7;
    }

    // ====================================================================
    // PRODUKTVISNING: RENDERA PRODUKTKORT P√Ö SIDAN
    // ====================================================================
    
    /**
     * Visa produkter p√• sidan genom att skapa HTML-struktur
     * Hanterar b√•de normala produktlistor och tomma s√∂kresultat
     * 
     * @param {Array} products - Array med produktobjekt att visa
     */
    function displayProducts(products) {
        const container = document.getElementById('products-container');
        
        // Hantera fallet n√§r inga produkter hittas
        if (products.length === 0) {
            const message = currentSearchQuery 
                ? `Inga produkter hittades f√∂r "${currentSearchQuery}"`
                : 'Inga produkter hittades.';
            container.innerHTML = `<div class="no-products">${message}</div>`;
            return;
        }
        
        // Skapa HTML f√∂r alla produkter
        const productsHTML = products.map(product => {
            // Kontrollera om produkten √§r ny f√∂r att visa "Nyhet"-m√§rkning
            const isNew = isNewProduct(product.created_at);
            
            // Returnera HTML-struktur f√∂r varje produktkort
            return `
                <div class="product-card" data-product-id="${product.id}" title="Klicka f√∂r att se detaljer">
                    <div class="product-image">
                        <!-- Produktbild -->
                        <img src="${product.image_url}" alt="${product.name}">
                        
                        <!-- Hj√§rt-overlay f√∂r √∂nskelista (visuell, ej funktionell) -->
                        <div class="product-overlay overlay-heart">
                            &#x2764;
                        </div>
                        
                        <!-- "Nyhet"-m√§rkning som visas endast f√∂r nya produkter -->
                        ${isNew ? '<div class="product-overlay overlay-banner">Nyhet</div>' : ''}
                    </div>
                    
                    <!-- Produktinformation -->
                    <div class="product-info">
                        <div class="product-info-name">
                            <h3>${product.name}</h3>
                            <p>${product.brand}</p>
                        </div>
                        <div class="product-info-price">${product.price} SEK</div>
                    </div>
                </div>
            `;
        }).join('');
        
        // S√§tt in all HTML i containern
        container.innerHTML = productsHTML;
        console.log('‚úÖ Produkter visade p√• sidan');
    }

    // ====================================================================
    // EVENT LISTENERS: S√ñKFUNKTIONALITET
    // ====================================================================
    
    /**
     * Konfigurera s√∂kfunktionalitet med olika triggare
     * - S√∂k medan anv√§ndaren skriver (med f√∂rdr√∂jning)
     * - S√∂k n√§r s√∂kknappen klickas
     * - S√∂k n√§r Enter trycks i s√∂kf√§ltet
     */
    function setupSearch() {
        const searchInput = document.querySelector('.search-bar .input');
        const searchButton = document.querySelector('.search-bar button');
        
        // ========================================================================
        // REALTIDSS√ñKNING: S√∂k medan anv√§ndaren skriver
        // ========================================================================
        
        let searchTimeout; // Variabel f√∂r att hantera timeout
        
        searchInput.addEventListener('input', function() {
            // Rensa tidigare timeout f√∂r att undvika on√∂diga s√∂kningar
            clearTimeout(searchTimeout);
            
            // Starta ny timeout som triggar s√∂kning efter 300ms
            searchTimeout = setTimeout(() => {
                searchProducts(this.value);
            }, 300); // V√§nta 300ms efter anv√§ndaren slutat skriva
        });
        
        // ========================================================================
        // KNAPP-S√ñKNING: S√∂k n√§r s√∂kknappen klickas
        // ========================================================================
        
        searchButton.addEventListener('click', function(e) {
            e.preventDefault(); // F√∂rhindra form submission
            searchProducts(searchInput.value);
        });
        
        // ========================================================================
        // ENTER-S√ñKNING: S√∂k n√§r Enter trycks i s√∂kf√§ltet
        // ========================================================================
        
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault(); // F√∂rhindra form submission
                searchProducts(this.value);
            }
        });
        
        console.log('‚úÖ S√∂kfunktionalitet aktiverad');
    }

    // ====================================================================
    // EVENT LISTENERS: PRODUKTKORT-NAVIGATION
    // ====================================================================
    
    /**
     * L√§gg till klickh√§ndelse f√∂r produktkort
     * N√§r anv√§ndaren klickar p√• ett produktkort navigeras de till produktsidan
     */
    function addProductClickListeners() {
        // Anv√§nd event delegation f√∂r att hantera dynamiskt skapade produktkort
        document.addEventListener('click', function(e) {
            // Hitta n√§rmaste produktkort-element
            const productCard = e.target.closest('.product-card');
            
            if (productCard) {
                // H√§mta produkt-ID fr√•n data-attribut
                const productId = productCard.dataset.productId;
                console.log('üñ±Ô∏è Produkt klickad, ID:', productId);
                
                // Navigera till produktdetaljsidan med produkt-ID som query parameter
                window.location.href = `/product-details.html?id=${productId}`;
            }
        });
    }

    // ====================================================================
    // HUVUDINITIALISERING: Starta allt n√§r sidan laddas
    // ====================================================================
    
    /**
     * DOMContentLoaded event listener som k√∂r n√§r hela DOM:en √§r laddad
     * Initialiserar alla huvudfunktioner f√∂r sidan
     */
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üìÑ Sida laddad, initialiserar funktionalitet...');
        
        // Starta produkth√§mtning fr√•n API
        fetchProducts();
        
        // Aktivera s√∂kfunktionalitet
        setupSearch();
        
        // Aktivera produktkort-klickhantering
        addProductClickListeners();
    });
    </script>
</body>

</html>