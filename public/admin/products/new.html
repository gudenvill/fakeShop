<!DOCTYPE html>
<html lang="sv">
<head>
  <!-- Meta-taggar f√∂r dokumenttyp och spr√•k -->
  <meta charset="UTF-8">
  
  <!-- Sidans titel som visas i webbl√§sarens flik -->
  <title>Administration: Ny produkt</title>
  
  <!-- CSS f√∂r admin-gr√§nssnittet -->
  <link rel="stylesheet" href="../../css/adminStyles.css">
</head>
<body>
  <!-- HUVUDCONTAINER F√ñR ADMIN-GR√ÑNSSNITTET -->
  <div class="admin-container">
    
    <!-- SIDEBAR: Navigeringsmeny f√∂r admin-funktioner -->
    <aside class="sidebar">
      <h2>Administration</h2>
      <!-- Navigeringsmeny f√∂r olika admin-sektioner -->
      <nav>
        <ul>
          <!-- L√§nk tillbaka till produktlistan -->
          <li><a href="/admin/products/index.html">Produkter</a></li>
        </ul>
      </nav>
    </aside>
    
    <!-- HUVUDINNEH√ÖLL: Formul√§r f√∂r att skapa ny produkt -->
    <main class="main-content">
      <h1>Ny produkt</h1>
      
      <!-- FRAMG√ÖNGSMEDDELANDE: Visas n√§r produkten skapats -->
      <div id="success-message" style="display: none; color: green; padding: 10px; margin-bottom: 20px; border: 1px solid green; background: #f0f8f0;">
        Produkt skapad framg√•ngsrikt!
      </div>
      
      <!-- FELMEDDELANDE: Visas vid problem med att skapa produkten -->
      <div id="error-message" style="display: none; color: red; padding: 10px; margin-bottom: 20px; border: 1px solid red; background: #fff0f0;">
        <!-- Felmeddelande visas h√§r dynamiskt av JavaScript -->
      </div>

      <!-- PRODUKTFORMUL√ÑR: Alla f√§lt f√∂r att skapa en ny produkt -->
      <form id="product-form">
        
        <!-- PRODUKTNAMN: Obligatoriskt f√§lt -->
        <label for="name">Namn *</label>
        <input type="text" id="name" name="name" maxlength="50" required placeholder="Ange namn">

        <!-- PRODUKTM√ÑRKE: Obligatoriskt f√§lt -->
        <label for="brand">M√§rke *</label>
        <input type="text" id="brand" name="brand" maxlength="50" required placeholder="Ange m√§rke">

        <!-- PRODUKTBESKRIVNING: Valfritt f√§lt -->
        <label for="description">Beskrivning</label>
        <textarea id="description" name="description" rows="4" placeholder="Ange beskrivning"></textarea>

        <!-- SKU (ARTIKELNUMMER): Obligatoriskt med specifikt format -->
        <label for="sku">SKU *</label>
        <input type="text" id="sku" name="sku" pattern="[A-Z]{3}[0-9]{3}" required placeholder="Ange SKU (t.ex. ABC123)">

        <!-- PRODUKTPRIS: Obligatoriskt, till√•ter decimaler -->
        <label for="price">Pris *</label>
        <input type="number" id="price" name="price" step="0.01" min="0" required placeholder="Ange pris">

        <!-- LAGERSALDO: Valfritt, standardv√§rde 0 -->
        <label for="stock_quantity">Lagersaldo</label>
        <input type="number" id="stock_quantity" name="stock_quantity" min="0" value="0" placeholder="Antal i lager">

        <!-- KATEGORIVAL: Radio buttons f√∂r olika produktkategorier -->
        <fieldset>
          <legend>Kategori</legend>
          <label><input type="radio" name="category" value="tshirts" checked> T-Shirts</label><br>
          <label><input type="radio" name="category" value="sommar"> Sommar</label><br>
          <label><input type="radio" name="category" value="byxor"> Byxor</label><br>
          <label><input type="radio" name="category" value="skor"> Skor</label><br>
          <label><input type="radio" name="category" value="vinterjackor"> Vinterjackor</label><br>
          <label><input type="radio" name="category" value="kjolar"> Kjolar</label>
        </fieldset>

        <!-- SUBMIT-KNAPP: Skickar formul√§ret -->
        <button type="submit" class="button" id="submit-btn">L√§gg till produkt</button>
      </form>
    </main>
  </div>

  <!-- JAVASCRIPT-SEKTION: All funktionalitet f√∂r att skapa nya produkter -->
  <script>
    // ====================================================================
    // FORMUL√ÑRHANTERING: SKAPA NY PRODUKT
    // ====================================================================
    
    /**
     * Event listener f√∂r formul√§rinl√§mning
     * Hanterar API-kommunikation f√∂r att skapa ny produkt
     */
    document.getElementById('product-form').addEventListener('submit', async function(e) {
      console.log('üìù Formul√§r f√∂r ny produkt skickat');
      
      // VIKTIGT: F√∂rhindra webbl√§sarens standard form submission
      e.preventDefault();
      
      // H√§mta referenser till UI-element
      const submitBtn = document.getElementById('submit-btn');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      
      // ================================================================
      // F√ñRBEREDA UI F√ñR SKICKNING
      // ================================================================
      
      // D√∂lj tidigare meddelanden
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      
      // Inaktivera knappen under skickning f√∂r att f√∂rhindra dubbelklick
      submitBtn.disabled = true;
      submitBtn.textContent = 'Skapar produkt...';
      
      try {
        // ============================================================
        // SAMLA FORMUL√ÑRDATA
        // ============================================================
        
        // Skapa FormData-objekt fr√•n formul√§ret
        const formData = new FormData(this);
        const category = formData.get('category');
        
        // Skapa produktobjekt med all data
        const productData = {
          name: formData.get('name'),                               // Produktnamn
          brand: formData.get('brand'),                             // M√§rke
          description: formData.get('description') || '',           // Beskrivning (tom str√§ng om saknas)
          price: parseFloat(formData.get('price')),                 // Pris som decimaltal
          sku: formData.get('sku'),                                 // Artikelnummer
          image_url: '/images/product.png',                         // Standardbild f√∂r alla produkter
          category: category,                                       // Vald kategori
          stock_quantity: parseInt(formData.get('stock_quantity')) || 0  // Lagersaldo (0 som standard)
        };
        
        console.log('üì§ Skickar produktdata:', productData);
        
        // ============================================================
        // SKICKA API-REQUEST
        // ============================================================
        
        // Skicka POST-request till produkter-API:et
        const response = await fetch('/api/products', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(productData)
        });
        
        // Parsea JSON-svaret fr√•n servern
        const result = await response.json();
        
        // Kontrollera om requestet var framg√•ngsrikt
        if (!response.ok) {
          throw new Error(result.error || `HTTP error! status: ${response.status}`);
        }
        
        console.log('‚úÖ Produkt skapad:', result);
        
        // ============================================================
        // HANTERA FRAMG√ÖNGSRIKT SVAR
        // ============================================================
        
        // Visa framg√•ngsmeddelande
        successMessage.style.display = 'block';
        
        // Rensa formul√§ret f√∂r n√§sta produkt
        this.reset();
        
        // Scroll till toppen f√∂r att visa meddelandet
        window.scrollTo(0, 0);
        
      } catch (error) {
        // ============================================================
        // FELHANTERING
        // ============================================================
        
        console.error('‚ùå Fel vid skapande av produkt:', error);
        
        // Visa felmeddelande f√∂r anv√§ndaren
        errorMessage.textContent = error.message;
        errorMessage.style.display = 'block';
        
        // Scroll till toppen f√∂r att visa felmeddelandet
        window.scrollTo(0, 0);
        
      } finally {
        // ============================================================
        // √ÖTERST√ÑLL UI EFTER SKICKNING
        // ============================================================
        
        // √Öterst√§ll knappen oavsett om det gick bra eller d√•ligt
        submitBtn.disabled = false;
        submitBtn.textContent = 'L√§gg till produkt';
      }
    });
  </script>
</body>
</html>
